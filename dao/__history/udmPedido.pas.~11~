unit udmPedido;

interface

uses
  System.SysUtils, System.Classes, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf,
  FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt, Data.DB,
  FireDAC.Comp.DataSet, FireDAC.Comp.Client, Datasnap.Provider,
  Datasnap.DBClient;

type
  TDataModule1 = class(TDataModule)
    fdqPedidos: TFDQuery;
    fdqPedido: TFDQuery;
    fdqInsert: TFDQuery;
    fdqUpdate: TFDQuery;
    cdsPesquisar: TClientDataSet;
    dspPesquisar: TDataSetProvider;
    cdsPesquisarcodpedido: TLargeintField;
    cdsPesquisardtemissao: TDateField;
    cdsPesquisarcodcli: TLargeintField;
    cdsPesquisarvltotal: TBCDField;
    cdsPesquisarnmcliente: TWideStringField;
  private
    { Private declarations }
  public
    { Public declarations }
    function RecuperaIDPedido: integer;
  end;

var
  DataModule1: TDataModule1;

implementation
uses
  udmConexao;
{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

{ TDataModule1 }

function TDataModule1.RecuperaIDPedido: integer;
var
  fdqCodPedido: TFDQuery;
begin
   fdqCodPedido := TFDQuery.Create(nil);
   try
     with fdqCodPedido do
     begin
       Connection := dmConexao.fdConexao;
       SQL.Add('select currtval(');
       SQL.Add(QuotedStr('pedido_codpedido_seq') + ')');
       SQL.Add(' as CodPedido;');
       Open;
       Result := FieldByName('CodPedido').AsInteger + 1;
     end;
   finally
     FreeAndNil(fdqCodPedido);
   end;
end;

end.
